import subprocess
import platform
import os

def check_adb_installed():
    try:
        # Check if ADB is installed by attempting to execute the 'adb' command
        subprocess.run(['adb'], stdout=subprocess.PIPE, stderr=subprocess.PIPE, check=True, text=True)
        return True
    except subprocess.CalledProcessError:
        return False

def install_adb():
    print("ADB is not installed.")
    
    # Check if the user has superuser permissions
    if not is_super_user():
        print("You need superuser (sudo) permissions to install ADB.")
        return
    
    # Detect the Linux distribution
    distribution = detect_distribution()
    
    # Install ADB based on the detected distribution
    if distribution == "debian":
        install_command = ['sudo', 'apt-get', 'update']
        subprocess.run(install_command, check=True)
        
        install_command = ['sudo', 'apt-get', 'install', 'android-tools-adb']
        subprocess.run(install_command, check=True)
        print("ADB installed successfully.")
    else:
        print(f"ADB installation for {distribution} is not supported.")
        print("Please install ADB manually.")

def is_super_user():
    try:
        return os.geteuid() == 0
    except AttributeError:
        return False

def detect_distribution():
    dist = platform.linux_distribution(full_distribution_name=False)[0].lower()
    
    if "debian" in dist:
        return "debian"
    elif "ubuntu" in dist:
        return "ubuntu"
    else:
        return "unknown"

def main():
    if check_adb_installed():
        print("ADB is already installed. OK.")
    else:
        install_adb()
